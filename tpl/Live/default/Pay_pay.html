<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>股播</title>
    <link rel="stylesheet" href="/tpl/Live/default/style/weui/dist/style/weui.min.css"/>
    <link rel="stylesheet" href="/tpl/Live/default/style/css/main.css"/>
    <link rel="stylesheet" href="/tpl/Live/default/style/weui/dist/example/example.css"/>
    <link rel="stylesheet" href="http://cdn.bootcss.com/Swiper/3.3.1/css/swiper.min.css">
    <script src="http://cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
    <script src="/tpl/Live/default/style/js/writingPad.js"></script>
    <script src="/tpl/Live/default/style/js/signature.js"></script>
    <style>
        #writingPad{
            width: 100%;
            height: 200px;
        }
        .top-tab{
            width: 100%;
            display: flex;
            background-color: #fff;
            color:#999;
        }
        .top-tab .itm{
            height: 60px;
            width: 33.333333%;
            border:1px solid #888;
            border-right:none;
            text-align: center;
            vertical-align: middle;
        }
        .top-tab .itm.active{
            color:#333;
        }
        .top-tab .item.last{
            border-right:1px solid #888;
        }
        .top-tab .itm div{
            vertical-align: middle;
        }
        .container{
            display: fixed;
            top: 60px;
            bottom: 64px;
            left: 0;
            right: 0;
            overflow: scroll;
        }
        .container .content{
            display: none;
        }
        .container .content.active{
            display: block;
        }
        .foot{
            position: fixed;
            bottom: 0;
            background-color: #777;
            height: 44px;
            left: 0;
            right: 0;
            overflow: hidden;
            padding: 10px;
        }
        .bottom-btn{
            margin-top: 0!important;
            display: none;
        }

    </style>
</head>
<body>

<!-- 我的    页面 -->
<div class="top-tab">
    <div class="itm active" id = "protocal">
        <div>①<br/>阅读协议</div>
    </div>
    <div class="itm" id = "fillInfo">
        <div>②<br/>填写信息</div>
    </div>
    <!--       <div class="itm" id = "signature">
            <div>③<br/>用户签名</div>
          </div> -->
    <div class="itm last" id = "check">
        <div>③<br/>确认付款</div>
    </div>
</div>

<!-- <button class="btn btn-primary" type="button" style="position:relative">点击我</button> -->
<!-- 内容 -->
<div class="container scroll">
    <div class="content active" id="cnt-protocal">
        <p>会员服务协议
            会员服务协议
            提示:请用户在填写本订购单前详细阅读内容,用户签署并填写本订购单,即视为用户与北京互享科技股份有限公司(以下简称“互享科技”)订立合同,本订购单即对双方具有相当于合同的法律约束力。
            北京互享科技股份有限公司旗下的“股播”微信服务号旨在搭建一个投资交流社交平台，平台将优选导师为大家提供证券投资观点分享，但相关观点及分享内容为导师个人观点，不代表平台观点。平台将不承担任何导师分享内容为用户带来的后果。

            一、基本资料
            用户姓名    手机号码      身份证

            二、订购内容及使用方法
            “股播”月度会员服务（收费标准：1000元/月），在2016年5月1日至2016年6月1日内享受活动期推广价0.01元/月。

            三、特别声明
            1、用户通过订阅“股播”月度会员服务所获得的资讯、个股信息等内容受著作权和其它财产所有权法律的保护，该等资讯、个股信息内容仅供用户投资决策参考使用，并不保证用户可通过该等内容获得利益，因投资所产生的风险均由用户自行承担。非经互享科技书面同意，用户不能擅自复制、传播或授权他人使用该等资讯、个股信息内容或以该等资讯、个股信息内容为基础创造与该等资讯内容有关的派生产品，无论是否以赢利为目的。用户擅自复制、传播及/或授权他人使用上述资讯内容、个股信息或利用资讯、个股信息内容的行为侵犯了互享科技的著作权、财产所有权等合法权利，由此造成互享科技损失，互享科技有权向用户追究责任。

            2、本订购单仅对用户和互享科技双方具有法律约束力，互享科技为履行本订购单需要从第三方取得终端使用权或委托第三方提供终端使用权售后服务的，其行为及其法律后果，由互享科技自行负责，与用户无关，用户亦不得依据本订购单向与互享科技合作的第三方主张任何权利。

            3、用户应对自己的个人信息予以保密，不要将个人信息和联系电话私自透露给业务办理人员，因用户本人将个人信息泄漏造成骚扰或其他后果的，互享科技不需承担任何责任。

            4、任何冒用互享科技名义让用户汇款到私人账户的诈骗份子，用户应警惕，不要汇款到私人账户，因此造成的财务损失，互享科技不需承担任何责任。

            5、用户使用通过使用该产品获得的资讯及个股信息所存在的风险将完全由用户本人承担；因用户使用内参产品获得的资讯及个股信息而产生的一切后果也由用户本人自己承担，互享科技对用户不承担任何责任，对于因不可抗力或计算机病毒、黑客攻击、系统不稳定、用户所在位置、用户关机以及其他任何技术、GSM网络、互联网络、通信线路等非因互享科技原因造成的服务中断或不能满足用户要求的，互享科技不承担任何责任，但将尽力减少因此而给用户造成的损失和影响。

            6、用户确认，互享科技已经向用户提示相关风险，且用户已清楚了解并知悉风险的全部内容。

            7、本订购单签订之日起5个工作日内，用户可以书面通知方式解除本订购单，若用户已经使用互享科技提供的登录账号及密码获取相关内容的，互享科技将根据使用次数扣除相应费用。但订购单签订之日起5个工作日后，用户无权单方解除合同，用户单方解除的，互享科技无义务退还用户已付款项。

            8、因履行本订购单而产生的纠纷，由互享科技所在地人民法院管辖。

            9、本订购单最终解释权归互享科技所有。
        </p>
    </div>
    <div class="content" id="cnt-fillInfo">
        <div class="weui_cells weui_cells_form">
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">姓名</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input id="name" class="weui_input" type="name" placeholder="请输入姓名">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">手机号</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input id="pNum" class="weui_input" type="tel" placeholder="请输入手机号">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">身份证</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input id="idNum" class="weui_input" type="text" placeholder="请输入身份证">
                </div>
            </div>
        </div>
    </div>
    <div class="content" id="cnt-signature">
        <!-- <button id="show" class="btn btn-primary" type="button" style="position:relative">点击我</button> -->
    </div>
    <div class="content" id="cnt-check">
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p id="service_name">开通服务：{pigcms:$data.payName}</p>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p id="open_time">开通时间：{pigcms:$data.payTime}</p>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p id="how_much">支付金额：{pigcms:$data.price}元</p>
            </div>
        </div>
    </div>
</div>
<!-- 底部 -->
<div class="foot">
    <a href="javascript:;" id="read-complete" class="weui_btn weui_btn_default">请滑动屏幕，确保阅读所有内容</a>
    <a href="javascript:;" id="info-complete" class="weui_btn weui_btn_default bottom-btn">请将信息填写完成</a>
    <a href="javascript:;" id="sig-complete" class="weui_btn weui_btn weui_btn_warn bottom-btn">保存签名并提交</a>
    <a href="javascript:;" id="pay-complete" class="weui_btn weui_btn weui_btn_warn bottom-btn">立即支付</a>
</div>
<!--BEGIN 信息弹窗 -->
<div class="weui_dialog_alert" id="dialog" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
        <div class="weui_dialog_bd">弹窗内容，告知当前页面信息等</div>
        <div class="weui_dialog_ft">
            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>
<!--END dialog2-->
<script>
    var params = {
        userId : '{pigcms:$data.userId}',
        fid : '{pigcms:$data.followUserId}',
        payName : '{pigcms:$data.payName}',
    }

    var $scrollContainer = $('.scroll')


        // 四个底部按钮
        var $step1bt =  $('#read-complete'),
                $step2bt =  $('#info-complete'),
                $step3bt =  $('#sig-complete'),
                $step4bt =  $('#pay-complete'),
        // 四个内容容器
                $content1 = $('#cnt-protocal'),
                $content2 = $('#cnt-fillInfo'),
                $content3 = $('#cnt-signature'),
                $content4 = $('#cnt-check'),
        // 四个顶部协议
                $tip1 = $('#protocal'),
                $tip2 = $('#fillInfo'),
                $tip3 = $('#signature'),
                $tip4 = $('#check'),
        // 弹框
                $dialog = $('#dialog'),
        // 姓名手机号身份证输入框
                $nameInput = $('#name'),
                $pNumInput = $('#pNum'),
                $idNumInput = $('#idNum'),
        // 容器

        // 保存数据集
                sendData = {},
        // 手写板
                wp

        // 正则
        var idRegexp = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,
                pnumRegexp = /^1[3|4|5|7|8][0-9]\d{8}$/
        $dialog.find('.weui_btn_dialog').on('click', function () {
            $dialog.hide();
        });

        $step2bt.click(function(){
            // 检测是否已经填写相关信息
            if($nameInput[0].value == '' || $pNumInput[0].value == '' || $idNumInput[0].value == '' ){
                $dialog.find('.weui_dialog_bd').html("请完整填写姓名，手机号和身份证")
                $dialog.show();
                return
            }
            if(!pnumRegexp.test($pNumInput[0].value)){
                $dialog.find('.weui_dialog_bd').html("不是正确的手机号")
                $dialog.show();
                return
            }
            if(!idRegexp.test($idNumInput[0].value)){
                $dialog.find('.weui_dialog_bd').html("不是正确的身份证号")
                $dialog.show();
                return
            }
            sendData.realName = $nameInput[0].value
            sendData.telNo = $pNumInput[0].value
            sendData.cardNo = $idNumInput[0].value
            sendData.fid = params.fid
            sendData.payName = params.payName
            sendData.type = 1;

            // wp = new WritingPad('#cnt-signature');
            var orderUrl = '{pigcms::U("Pay/writeOrder")}';
            $.post(orderUrl, sendData, function(data){
                console.log(data);
                if(data.errcode == 0){
                    $step2bt.hide()
                    $step4bt.css("display",'block')
                    $content2.hide()
                    $content4.show()
                    $tip2.removeClass('active')
                    $tip4.addClass('active')
                    params.orderId = data.id;
                }else{
                    alert(data.msg);
                }
            }, 'JSON')
        })
        console.log(params);
        // 第三块签名暂不开启
        // $step3bt.click(function(){
        //   $step3bt.hide()
        //   $step4bt.css("display",'block')
        //   $content3.hide()
        //   $content4.show()
        //   $tip3.removeClass('active')
        //   $tip4.addClass('active')
        // })
        $step4bt.click(function(){
            var payUrl = '{pigcms::U("Pay/payOrder")}&fid={pigcms:$data.followUserId}';
            location.href = payUrl;
            /*$.ajax({
                type : 'get',
                url: payUrl + '&fid=' + params.followUserId,
                dataType:'json',
                data:{},
                success:function(data){
                    console.log(data);
                    if(data.errcode == 0){
                        location.href = data.url;
                    }else{
                        $dialog.hide()
                        $dialog.find('.weui_dialog_bd').html(data.msg)
                        $dialog.show()
                    }
                },
                error:function(){
                    $dialog.hide()
                    $dialog.find('.weui_dialog_bd').html("网络错误，请确保连上网络后再进行提交")
                    $dialog.show()
                }
            })*/
        })

        $scrollContainer[0].addEventListener('scroll',function(){
            console.log(111111)
            console.log()
            if($content1.css('display') !== 'none' && ($scrollContainer[0].scrollTop + 20 > ($content1[0].offsetHeight - $scrollContainer[0].clientHeight))){
                // console.log($scrollContainer[0].scrollTop,$content1[0].offsetHeight,$content1[0].offsetHeight - $scrollContainer[0].clientHeight)
                $step1bt.removeClass('weui_btn_default')
                $step1bt.addClass('weui_btn_primary')
                // 点击后
                $step1bt.click(function(){
                    $step1bt.hide()
                    $step2bt.css("display",'block')
                    $content1.hide()
                    $content2.show()
                    $tip1.removeClass('active')
                    $tip2.addClass('active')
                })
            }
        },false)

    // $('body').on('touchmove', function (event) {
    //   event.preventDefault();
    // });
</script>
</body>
</html>

